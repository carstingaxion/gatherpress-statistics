(()=>{"use strict";var e,t={693:(e,t,s)=>{const a=window.wp.blocks,i=window.wp.i18n,r=window.wp.blockEditor,n=window.wp.components,l=window.wp.data,o=window.wp.element,c=window.wp.apiFetch;var h=s.n(c);const p=window.ReactJSXRuntime,_=JSON.parse('{"UU":"gatherpress/statistics"}');(0,a.registerBlockType)(_.UU,{edit:function({attributes:e,setAttributes:t,clientId:s}){const{statisticType:a,labelSingular:c,labelPlural:_,selectedTaxonomyTerms:g,selectedTerm:m,selectedTaxonomy:d,countTaxonomy:u,filterTaxonomy:x,eventQuery:y,showLabel:f,prefixDefault:v,suffixDefault:b,prefixConditional:T,suffixConditional:j,conditionalThreshold:C}=e,{updateBlockAttributes:w}=(0,l.useDispatch)("core/block-editor"),[S]=(0,o.useState)(()=>Math.floor(100*Math.random())+1),[k,E]=(0,o.useState)([]),[O,P]=(0,o.useState)([]),[N,F]=(0,o.useState)(!0),[B,U]=(0,o.useState)(!0);(0,o.useEffect)(()=>{F(!0),h()({path:"/gatherpress-statistics/v1/taxonomies"}).then(e=>{E(e),F(!1)}).catch(()=>{E([]),F(!1)})},[]),(0,o.useEffect)(()=>{U(!0),h()({path:"/gatherpress-statistics/v1/supported-types"}).then(e=>{P(e),U(!1)}).catch(()=>{P([]),U(!1)})},[]),(0,o.useEffect)(()=>{"total_attendees"===a?"past"!==y&&t({eventQuery:"past"}):y&&["upcoming","past"].includes(y)||t({eventQuery:"past"})},[a,y,t]);const L=(0,l.useSelect)(e=>{if(!k||0===k.length)return{};const{getEntityRecords:t}=e("core"),s={};return k.forEach(e=>{const a=t("taxonomy",e.slug,{per_page:-1});a&&(s[e.slug]=a)}),s},[k]);(0,o.useEffect)(()=>{let e="";switch(a){case"total_events":e=(0,i.__)("Total Events","gatherpress-statistics");break;case"total_attendees":e=(0,i.__)("Total Attendees","gatherpress-statistics");break;case"events_per_taxonomy":if(d&&m){const t=k?.find(e=>e.slug===d),s=L[d]?.find(e=>e.id===m);e=t&&s?`${t.name}: ${s.name}`:(0,i.__)("Events per Taxonomy","gatherpress-statistics")}else e=(0,i.__)("Events per Taxonomy","gatherpress-statistics");break;case"events_multi_taxonomy":if(g&&Object.keys(g).length>0){const t=[];Object.entries(g).forEach(([e,s])=>{if(s&&s.length>0){const a=L[e]||[];s.forEach(e=>{const s=a.find(t=>t.id===e);s&&t.push(s.name)})}}),e=t.length>0?(0,i.__)("Events:","gatherpress-statistics")+" "+t.join(", "):(0,i.__)("Events (Multiple Taxonomies)","gatherpress-statistics")}else e=(0,i.__)("Events (Multiple Taxonomies)","gatherpress-statistics");break;case"total_taxonomy_terms":if(d){const t=k?.find(e=>e.slug===d);e=t?(0,i.__)("Total","gatherpress-statistics")+" "+t.name:(0,i.__)("Total Taxonomy Terms","gatherpress-statistics")}else e=(0,i.__)("Total Taxonomy Terms","gatherpress-statistics");break;case"taxonomy_terms_by_taxonomy":if(u&&x&&m){const t=k?.find(e=>e.slug===u),s=k?.find(e=>e.slug===x),a=L[x]?.find(e=>e.id===m);e=t&&s&&a?`${t.name} in ${s.name}: ${a.name}`:(0,i.__)("Taxonomy Terms by Taxonomy","gatherpress-statistics")}else e=(0,i.__)("Taxonomy Terms by Taxonomy","gatherpress-statistics");break;default:e=(0,i.__)("GatherPress Statistics","gatherpress-statistics")}"total_attendees"===a?e=(0,i.__)("Past","gatherpress-statistics")+": "+e:"upcoming"===y?e=(0,i.__)("Upcoming","gatherpress-statistics")+": "+e:"past"===y&&(e=(0,i.__)("Past","gatherpress-statistics")+": "+e),e&&w(s,{metadata:{name:e}})},[a,g,m,d,u,x,y,k,L,s,w]);const D=[{label:(0,i.__)("Total Events","gatherpress-statistics"),value:"total_events"},{label:(0,i.__)("Total Attendees","gatherpress-statistics"),value:"total_attendees"},{label:(0,i.__)("Events per Taxonomy Term","gatherpress-statistics"),value:"events_per_taxonomy"},{label:(0,i.__)("Events (Multiple Taxonomies)","gatherpress-statistics"),value:"events_multi_taxonomy"},{label:(0,i.__)("Total Taxonomy Terms","gatherpress-statistics"),value:"total_taxonomy_terms"},{label:(0,i.__)("Taxonomy Terms by Another Taxonomy","gatherpress-statistics"),value:"taxonomy_terms_by_taxonomy"}],M=B?D:D.filter(e=>O.includes(e.value)),A=O.includes(a),Q=["events_per_taxonomy","total_attendees"].includes(a),$=["events_multi_taxonomy"].includes(a),I=["total_taxonomy_terms"].includes(a),R=["taxonomy_terms_by_taxonomy"].includes(a),J=!["total_taxonomy_terms","taxonomy_terms_by_taxonomy","total_attendees"].includes(a),W=k?k.map(e=>({label:e.name,value:e.slug})):[],G=(d&&L[d]&&L[d].map(e=>({label:e.name,value:e.id})),S>C),X=G&&T?T:v,q=G&&j?j:b,z=1===S?c:_;return(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(r.InspectorControls,{children:[!B&&!A&&(0,p.jsx)(n.Notice,{status:"warning",isDismissible:!1,children:(0,i.__)("This statistic type is currently disabled. Enable it in your theme or plugin to use this block.","gatherpress-statistics")}),(0,p.jsxs)(n.PanelBody,{title:(0,i.__)("Statistic Settings","gatherpress-statistics"),children:[(0,p.jsx)(n.SelectControl,{label:(0,i.__)("Statistic Type","gatherpress-statistics"),value:a,options:M,onChange:e=>{t({statisticType:e}),t({selectedTaxonomyTerms:{},selectedTerm:0,selectedTaxonomy:"",countTaxonomy:"",filterTaxonomy:""}),"total_attendees"===e&&t({eventQuery:"past"})},disabled:B}),J&&(0,p.jsx)(n.ToggleControl,{label:(0,i.__)("Upcoming Events","gatherpress-statistics"),checked:"upcoming"===y,onChange:e=>t({eventQuery:e?"upcoming":"past"}),help:"upcoming"===y?(0,i.__)("Showing statistics for upcoming events","gatherpress-statistics"):(0,i.__)("Showing statistics for past events","gatherpress-statistics")}),(0,p.jsx)(n.ToggleControl,{label:(0,i.__)("Show Label","gatherpress-statistics"),checked:f,onChange:e=>t({showLabel:e})}),f&&(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(n.TextControl,{label:(0,i.__)("Label (Singular)","gatherpress-statistics"),value:c,onChange:e=>t({labelSingular:e}),help:(0,i.__)("Used when count is 1","gatherpress-statistics")}),(0,p.jsx)(n.TextControl,{label:(0,i.__)("Label (Plural)","gatherpress-statistics"),value:_,onChange:e=>t({labelPlural:e}),help:(0,i.__)("Used when count is greater than 1","gatherpress-statistics")})]})]}),(0,p.jsxs)(n.PanelBody,{title:(0,i.__)("Prefix & Suffix","gatherpress-statistics"),initialOpen:!1,children:[(0,p.jsx)(n.TextControl,{label:(0,i.__)("Default Prefix","gatherpress-statistics"),value:v,onChange:e=>t({prefixDefault:e}),placeholder:(0,i.__)("e.g., +","gatherpress-statistics")}),(0,p.jsx)(n.TextControl,{label:(0,i.__)("Default Suffix","gatherpress-statistics"),value:b,onChange:e=>t({suffixDefault:e}),placeholder:(0,i.__)("e.g., total","gatherpress-statistics")}),(0,p.jsx)("hr",{}),(0,p.jsx)(n.__experimentalNumberControl,{label:(0,i.__)("Conditional Threshold","gatherpress-statistics"),value:C,onChange:e=>t({conditionalThreshold:parseInt(e,10)||10}),min:1,help:(0,i.__)("Use alternate prefix/suffix when count exceeds this value","gatherpress-statistics")}),(0,p.jsx)(n.TextControl,{label:(0,i.__)("Conditional Prefix","gatherpress-statistics"),value:T,onChange:e=>t({prefixConditional:e}),placeholder:(0,i.__)("e.g., Over","gatherpress-statistics"),help:(0,i.__)("Used when count > threshold","gatherpress-statistics")}),(0,p.jsx)(n.TextControl,{label:(0,i.__)("Conditional Suffix","gatherpress-statistics"),value:j,onChange:e=>t({suffixConditional:e}),placeholder:(0,i.__)("e.g., and counting!","gatherpress-statistics"),help:(0,i.__)("Used when count > threshold","gatherpress-statistics")})]}),Q&&A&&(0,p.jsx)(n.PanelBody,{title:(0,i.__)("Taxonomy Filter","gatherpress-statistics"),initialOpen:!1,children:N?(0,p.jsx)("p",{children:(0,i.__)("Loading taxonomies...","gatherpress-statistics")}):k&&k.length>0?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(n.SelectControl,{label:(0,i.__)("Select Taxonomy","gatherpress-statistics"),value:d,options:[{label:(0,i.__)("Select a taxonomy","gatherpress-statistics"),value:""},...W],onChange:e=>{t({selectedTaxonomy:e,selectedTerm:0})}}),d&&L[d]&&(0,p.jsx)(n.FormTokenField,{label:(0,i.__)("Select Term","gatherpress-statistics"),value:m?[L[d].find(e=>e.id===m)?.name].filter(Boolean):[],suggestions:L[d].map(e=>e.name),onChange:e=>{if(e.length>0){const s=L[d].find(t=>t.name===e[0]);s&&t({selectedTerm:s.id})}else t({selectedTerm:0})},maxLength:1,help:(0,i.__)("Select one term to filter by","gatherpress-statistics")})]}):(0,p.jsx)("p",{children:(0,i.__)("No taxonomies available","gatherpress-statistics")})}),I&&A&&(0,p.jsx)(n.PanelBody,{title:(0,i.__)("Taxonomy Selection","gatherpress-statistics"),initialOpen:!1,children:N?(0,p.jsx)("p",{children:(0,i.__)("Loading taxonomies...","gatherpress-statistics")}):k&&k.length>0?(0,p.jsx)(n.SelectControl,{label:(0,i.__)("Select Taxonomy","gatherpress-statistics"),value:d,options:[{label:(0,i.__)("Select a taxonomy","gatherpress-statistics"),value:""},...W],onChange:e=>t({selectedTaxonomy:e})}):(0,p.jsx)("p",{children:(0,i.__)("No taxonomies available","gatherpress-statistics")})}),R&&A&&(0,p.jsx)(n.PanelBody,{title:(0,i.__)("Taxonomy Configuration","gatherpress-statistics"),initialOpen:!1,children:N?(0,p.jsx)("p",{children:(0,i.__)("Loading taxonomies...","gatherpress-statistics")}):k&&k.length>0?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(n.SelectControl,{label:(0,i.__)("Count Terms From","gatherpress-statistics"),value:u,options:[{label:(0,i.__)("Select taxonomy to count","gatherpress-statistics"),value:""},...W],onChange:e=>t({countTaxonomy:e}),help:(0,i.__)("Which taxonomy terms should be counted?","gatherpress-statistics")}),(0,p.jsx)(n.SelectControl,{label:(0,i.__)("Filter By Taxonomy","gatherpress-statistics"),value:x,options:[{label:(0,i.__)("Select taxonomy to filter by","gatherpress-statistics"),value:""},...W],onChange:e=>{t({filterTaxonomy:e,selectedTerm:0})},help:(0,i.__)("Which taxonomy should be used to filter?","gatherpress-statistics")}),x&&L[x]&&(0,p.jsx)(n.SelectControl,{label:(0,i.__)("Select Term","gatherpress-statistics"),value:m,options:[{label:(0,i.__)("Select a term","gatherpress-statistics"),value:0},...L[x].map(e=>({label:e.name,value:e.id}))],onChange:e=>t({selectedTerm:parseInt(e,10)})})]}):(0,p.jsx)("p",{children:(0,i.__)("No taxonomies available","gatherpress-statistics")})}),$&&A&&k&&k.length>0&&(0,p.jsx)(p.Fragment,{children:k.map(e=>{const s=L[e.slug]||[],a=s.reduce((e,t)=>(e[t.name]=t,e),{}),r=g[e.slug]||[],l=s.filter(e=>r.includes(e.id)).map(e=>e.name);return(0,p.jsx)(n.PanelBody,{title:e.name,initialOpen:!1,children:s.length>0?(0,p.jsx)(n.FormTokenField,{label:(0,i.__)("Select Terms","gatherpress-statistics"),value:l,suggestions:Object.keys(a),onChange:s=>{const i=s.map(e=>a[e]?.id).filter(Boolean),r={...g,[e.slug]:i};t({selectedTaxonomyTerms:r})}}):(0,p.jsx)("p",{children:(0,i.__)("No terms found","gatherpress-statistics")})},e.slug)})})]}),(0,p.jsx)("div",{...(0,r.useBlockProps)(),children:B||A?(0,p.jsxs)("div",{className:"gatherpress-stats-preview",children:[(0,p.jsxs)("div",{className:"gatherpress-stats-value",children:[X&&(0,p.jsx)("span",{className:"gatherpress-stats-prefix",children:X}),X&&" ",(0,p.jsx)("span",{className:"gatherpress-stats-number",children:S}),q&&" ",q&&(0,p.jsx)("span",{className:"gatherpress-stats-suffix",children:q})]}),f&&(0,p.jsx)("div",{className:"gatherpress-stats-label",children:z})]}):(0,p.jsxs)("div",{className:"gatherpress-stats-preview",style:{opacity:.5},children:[(0,p.jsx)("div",{className:"gatherpress-stats-value",children:"⚠️"}),(0,p.jsx)("div",{className:"gatherpress-stats-label",children:(0,i.__)("Statistic type disabled","gatherpress-statistics")})]})})]})}})}},s={};function a(e){var i=s[e];if(void 0!==i)return i.exports;var r=s[e]={exports:{}};return t[e](r,r.exports,a),r.exports}a.m=t,e=[],a.O=(t,s,i,r)=>{if(!s){var n=1/0;for(h=0;h<e.length;h++){for(var[s,i,r]=e[h],l=!0,o=0;o<s.length;o++)(!1&r||n>=r)&&Object.keys(a.O).every(e=>a.O[e](s[o]))?s.splice(o--,1):(l=!1,r<n&&(n=r));if(l){e.splice(h--,1);var c=i();void 0!==c&&(t=c)}}return t}r=r||0;for(var h=e.length;h>0&&e[h-1][2]>r;h--)e[h]=e[h-1];e[h]=[s,i,r]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={57:0,350:0};a.O.j=t=>0===e[t];var t=(t,s)=>{var i,r,[n,l,o]=s,c=0;if(n.some(t=>0!==e[t])){for(i in l)a.o(l,i)&&(a.m[i]=l[i]);if(o)var h=o(a)}for(t&&t(s);c<n.length;c++)r=n[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(h)},s=globalThis.webpackChunkgatherpress_statistics=globalThis.webpackChunkgatherpress_statistics||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))})();var i=a.O(void 0,[350],()=>a(693));i=a.O(i)})();